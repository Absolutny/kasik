<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–ª—ç–∫–¥–∂–µ–∫ - Casino</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –±–ª—ç–∫–¥–∂–µ–∫–∞ */
        @keyframes cardDeal {
            0% {
                transform: translateY(-100px) rotate(-10deg);
                opacity: 0;
            }
            100% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
        }
        
        @keyframes cardHit {
            0% {
                transform: translateX(-100px) rotate(-20deg);
                opacity: 0;
            }
            100% {
                transform: translateX(0) rotate(0deg);
                opacity: 1;
            }
        }
        
        @keyframes chipBet {
            0% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes resultPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 rgba(76, 175, 80, 0);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
            }
        }
        
        .card.new-card {
            animation: cardDeal 0.5s ease-out forwards;
        }
        
        .card.hit-card {
            animation: cardHit 0.5s ease-out forwards;
        }
        
        .bet-chip.selected {
            animation: chipBet 0.3s ease-out;
        }
        
        .hand-value {
            transition: all 0.3s ease;
        }
        
        .hand-value.changed {
            animation: resultPulse 0.5s ease 2;
        }
        
        .game-message.win-message {
            animation: resultPulse 1s ease-in-out 3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ô†Ô∏è –ë–ª—ç–∫–¥–∂–µ–∫ 21 ‚ô•Ô∏è</h1>
            <div class="balance">–ë–∞–ª–∞–Ω—Å: <span id="balance">{{ balance }}</span> –∫–æ–ø–µ–π–∫–∞</div>
        </div>

        <div class="games-navigation">
            <a href="/" class="nav-btn">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/slots" class="nav-btn">üéØ –°–ª–æ—Ç—ã</a>
            <a href="/coinflip" class="nav-btn">ü™ô –ú–æ–Ω–µ—Ç–∫–∞</a>
            <a href="/dice" class="nav-btn">üé≤ –ö–æ—Å—Ç–∏</a>
        </div>

        <div class="blackjack-container">
            <!-- –°—Ç–∞–¥–∏—è —Å—Ç–∞–≤–∫–∏ -->
            {% if game_state == 'betting' %}
            <div class="betting-stage">
                <h2>üí∞ –°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É</h2>
                <form method="POST" class="bet-form" id="betForm">
                    <div class="bet-options" id="betOptions">
                        <label>
                            <input type="radio" name="bet" value="10" checked>
                            <span class="bet-chip">10 –∫–æ–ø–µ–π–∫–∞</span>
                        </label>
                        <label>
                            <input type="radio" name="bet" value="25">
                            <span class="bet-chip">25 –∫–æ–ø–µ–π–∫–∞</span>
                        </label>
                        <label>
                            <input type="radio" name="bet" value="50">
                            <span class="bet-chip">50 –∫–æ–ø–µ–π–∫–∞</span>
                        </label>
                        <label>
                            <input type="radio" name="bet" value="100">
                            <span class="bet-chip">100 –∫–æ–ø–µ–π–∫–∞</span>
                        </label>
                        <label>
                            <input type="radio" name="bet" value="500">
                            <span class="bet-chip">500 –∫–æ–ø–µ–π–∫–∞</span>
</label>
                        <label>
                            <input type="radio" name="bet" value="1000">
                            <span class="bet-chip">1000 –∫–æ–ø–µ–π–∫–∞</span>
                        </label>
                    </div>
                    <button type="submit" name="action" value="place_bet" class="deal-btn" id="dealBtn">
                        üé≤ –†–∞–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—ã
                    </button>
                </form>
            </div>
            {% endif %}

            <!-- –ò–≥—Ä–æ–≤–æ–π —Å—Ç–æ–ª -->
            <div class="game-table">
                <!-- –†—É–∫–∞ –¥–∏–ª–µ—Ä–∞ -->
                <div class="dealer-section">
                    <h3>üé© –î–∏–ª–µ—Ä: <span class="hand-value" id="dealerValue">{{ dealer_value }}</span></h3>
                    <div class="cards-container" id="dealerCards">
                        {% for card in dealer_hand %}
                        <div class="card {% if loop.index == 2 and dealer_value == '?' %}hidden-card{% endif %} 
                            {% if loop.last and game_state != 'betting' %}new-card{% endif %}">
                            {{ card }}
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
                <div class="table-divider"></div>

                <!-- –†—É–∫–∞ –∏–≥—Ä–æ–∫–∞ -->
                <div class="player-section">
                    <h3>üë§ –í—ã: <span class="hand-value" id="playerValue">{{ player_value }}</span></h3>
                    <div class="cards-container" id="playerCards">
                        {% for card in player_hand %}
                        <div class="card {% if loop.last and game_state != 'betting' %}new-card{% endif %}">
                            {{ card }}
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- –¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞ -->
                {% if current_bet > 0 %}
                <div class="current-bet" id="currentBet">
                    üí∞ –¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞: <strong>{{ current_bet }} –∫–æ–ø–µ–π–∫–∞</strong>
                </div>
                {% endif %}
            </div>

            <!-- –î–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞ -->
            {% if game_state == 'player_turn' %}
            <div class="player-actions">
                <form method="POST" class="action-buttons" id="actionForm">
                    <button type="submit" name="action" value="hit" class="action-btn hit-btn" id="hitBtn">
                        ‚ûï –í–∑—è—Ç—å –∫–∞—Ä—Ç—É
                    </button>
                    <button type="submit" name="action" value="stand" class="action-btn stand-btn" id="standBtn">
                        ‚úã –•–≤–∞—Ç–∏—Ç
                    </button>
                </form>
            </div>
            {% endif %}

            <!-- –ù–æ–≤–∞—è –∏–≥—Ä–∞ -->
            {% if game_state == 'game_over' %}
            <div class="new-game">
                <form method="POST" id="newGameForm">
                    <button type="submit" name="action" value="new_game" class="new-game-btn" id="newGameBtn">
                        üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞
                    </button>
                </form>
            </div>
            {% endif %}

            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ -->
            {% if message %}
            <div class="game-message {% if '–≤—ã–∏–≥—Ä–∞–ª–∏' in message or '–ë–ª—ç–∫–¥–∂–µ–∫' in message %}win-message{% else %}lose-message{% endif %}" 
                 id="gameMessage">
                {{ message }}
            </div>
            {% endif %}
        </div>

        <!-- –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã -->
        <div class="game-rules">
            <h3>üìñ –ü—Ä–∞–≤–∏–ª–∞ –ë–ª—ç–∫–¥–∂–µ–∫–∞:</h3>
            <div class="rules-grid">
                <div class="rule-item">
                    <span class="rule-icon">üéØ</span>
<p>–¶–µ–ª—å - –Ω–∞–±—Ä–∞—Ç—å 21 –æ—á–∫–æ –∏–ª–∏ –±–æ–ª—å—à–µ –¥–∏–ª–µ—Ä–∞</p>
                </div>
                <div class="rule-item">
                    <span class="rule-icon">üÉè</span>
                    <p>–ö–∞—Ä—Ç—ã 2-10 = –Ω–æ–º–∏–Ω–∞–ª, J/Q/K = 10, A = 1 –∏–ª–∏ 11</p>
                </div>
                <div class="rule-item">
                    <span class="rule-icon">üëë</span>
                    <p>–ë–ª—ç–∫–¥–∂–µ–∫ (21) = x2.5 –≤—ã–∏–≥—Ä—ã—à</p>
                </div>
                <div class="rule-item">
                    <span class="rule-icon">ü§ñ</span>
                    <p>–î–∏–ª–µ—Ä –±–µ—Ä–µ—Ç –∫–∞—Ä—Ç—ã –¥–æ 17 –æ—á–∫–æ–≤</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const betChips = document.querySelectorAll('.bet-chip');
            const dealBtn = document.getElementById('dealBtn');
            const hitBtn = document.getElementById('hitBtn');
            const standBtn = document.getElementById('standBtn');
            const newGameBtn = document.getElementById('newGameBtn');
            const gameMessage = document.getElementById('gameMessage');
            const playerValue = document.getElementById('playerValue');
            const dealerValue = document.getElementById('dealerValue');
            const playerCards = document.getElementById('playerCards');
            const dealerCards = document.getElementById('dealerCards');
            const currentBet = document.getElementById('currentBet');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ñ–∏—à–∫–∏
            betChips.forEach(chip => {
                chip.addEventListener('click', function() {
                    betChips.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫
            [dealBtn, hitBtn, standBtn, newGameBtn].forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', function(e) {
                        this.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            this.style.transform = 'scale(1)';
                        }, 100);
                    });
                }
            });
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
            if (gameMessage) {
                if (gameMessage.classList.contains('win-message')) {
                    gameMessage.classList.add('win-message');
                }
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    if (gameMessage) {
                        gameMessage.style.opacity = '0';
                        gameMessage.style.transition = 'opacity 0.5s';
                        setTimeout(() => {
                            if (gameMessage && gameMessage.parentNode) {
                                gameMessage.style.display = 'none';
                            }
                        }, 500);
                    }
                }, 5000);
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π —Ä—É–∫
            if (playerValue) {
                const originalPlayerValue = playerValue.textContent;
                const observerPlayer = new MutationObserver(function() {
                    if (playerValue.textContent !== originalPlayerValue) {
                        playerValue.classList.add('changed');
                        setTimeout(() => {
                            playerValue.classList.remove('changed');
                        }, 1000);
                    }
                });
                
                observerPlayer.observe(playerValue, {
                    characterData: true,
                    childList: true,
subtree: true
                });
            }
            
            if (dealerValue && dealerValue.textContent !== '?') {
                dealerValue.classList.add('changed');
                setTimeout(() => {
                    dealerValue.classList.remove('changed');
                }, 1000);
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Å—Ç–∞–≤–∫–∏
            if (currentBet) {
                currentBet.style.animation = 'chipBet 0.5s ease-out';
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            setTimeout(() => {
                const cards = document.querySelectorAll('.card');
                cards.forEach((card, index) => {
                    if (card.classList.contains('new-card')) {
                        setTimeout(() => {
                            card.style.animation = 'cardDeal 0.5s ease-out forwards';
                        }, index * 100);
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
